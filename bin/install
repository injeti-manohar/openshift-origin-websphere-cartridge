#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

case "$1" in
  -v|--version)
    version="$2"
esac

echo "$version" > "$OPENSHIFT_WEBSPHERE_DIR/env/OPENSHIFT_WEBSPHERE_VERSION"

echo 'Generating username and password'

username=$(generate_username)
password=$(generate_password)

echo "$username" > ${OPENSHIFT_WEBSPHERE_DIR}/env/OPENSHIFT_WEBSPHERE_ADMIN_USERNAME
echo "$password" > ${OPENSHIFT_WEBSPHERE_DIR}/env/OPENSHIFT_WEBSPHERE_ADMIN_PASSWORD

client_result ""
client_result "Websphere version: ${version} created.  Please make note of these Administrative User credentials:"
client_result ""
client_result "       Username: $username"
client_result "       Password: $password"
client_result "        Profile: $OPENSHIFT_APP_NAME"
client_result ""

client_result ""

echo "${OPENSHIFT_DATA_DIR}/profile" > ${OPENSHIFT_WEBSPHERE_DIR}/env/OPENSHIFT_WEBSPHERE_PROFILE
echo "server1" > ${OPENSHIFT_WEBSPHERE_DIR}/env/OPENSHIFT_WEBSPHERE_SERVERNAME

ln -s ${OPENSHIFT_WEBSPHERE_INSTALL_LOCATION} ${OPENSHIFT_WEBSPHERE_DIR}/install

${OPENSHIFT_WEBSPHERE_DIR}/install/bin/manageprofiles.sh -create \
-profileName ${OPENSHIFT_APP_NAME} \
-profilePath ${OPENSHIFT_DATA_DIR}profile \
-templatePath ${OPENSHIFT_WEBSPHERE_INSTALL_LOCATION}/profileTemplates/default/ \
-adminUsername ${username} \
-adminPassword ${password} \
-applyPerfTuningSetting development \
-enableAdminSecurity true \
-hostName ${OPENSHIFT_WEBSPHERE_IP}


